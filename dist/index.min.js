/**
   * @license
   * author: Ruslan Zakharov
   * ganttCanvas.js v0.2.6
   * Released under the MIT license.
   */
var ganttCanvas=function(){"use strict";var t=function(){function t(t){this.root=t}return t.prototype.renderDay=function(t,e){this.renderDayBackground(t,e),this.renderDayBottomLine(t,e),this.renderDayStartMonthLine(t,e),this.renderDayText(t,e)},t.prototype.renderDayBackground=function(t,e){var o=t.x,i=t.today,r=t.weekend,s=e.monthHeight,n=e.dayHeight,a=this.root.ctx,h=this.root.api.dayHeaderBackground;i&&this.root.api.dayHeaderTodayBackground?h=this.root.api.dayHeaderTodayBackground:r&&this.root.api.dayHeaderWeekendBackground&&(h=this.root.api.dayHeaderWeekendBackground),h&&(a.fillStyle=h,a.fillRect(o,s,this.root.grid.view.colWidth,n))},t.prototype.renderDayBottomLine=function(t,e){var o=t.x,i=e.monthHeight,r=e.width,s=e.dayHeight,n=this.root.ctx;n.beginPath(),n.strokeStyle=this.root.api.dayBottomLineColor,n.moveTo(o,i+s),n.lineTo(o+r,i+s),n.stroke()},t.prototype.renderDayStartMonthLine=function(t,e){var o=t.x,i=t.isStartMonth,r=e.monthHeight,s=e.dayHeight,n=this.root.ctx;i&&this.root.api.renderDayStartMonthLine&&(n.beginPath(),n.strokeStyle=this.root.api.dayStartMonthLine,n.moveTo(o,r),n.lineTo(o,r+s),n.stroke())},t.prototype.renderDayText=function(t,e){var o=t.x,i=t.title,r=t.weekend,s=t.month,n=t.hour,a=t.weekdayTitle,h=e.monthHeight,d=e.width,l=e.dayHeight,u=this.root.ctx;if(u.font=this.root.api.dayFont,u.textAlign="center",r&&this.root.api.dayWeekendColor?u.fillStyle=this.root.api.dayWeekendColor:u.fillStyle=this.root.api.dayColor,"month"===this.root.api.viewMode?i=this.root.grid.view.getMonthTitle(s):-1!==["half-day","quarter-day","three-hours","hour"].indexOf(this.root.api.viewMode)&&(i=n.toString()),a){var c=l/6;u.textBaseline="top",u.fillText(i,o+d/2,h+c),u.font=this.root.api.weekdayFont,r&&this.root.api.weekdayWeekendColor?u.fillStyle=this.root.api.weekdayWeekendColor:u.fillStyle=this.root.api.weekdayColor,u.textBaseline="bottom",u.fillText(a,o+d/2,h+l-c)}else u.textBaseline="middle",u.fillText(i,o+d/2,h+l/2);u.textAlign="left",u.textBaseline="alphabetic"},t.prototype.renderCol=function(t,e){var o=t.x,i=t.today,r=t.weekend,s=t.isStartMonth,n=e.monthHeight,a=e.dayHeight,h=this.root.ctx;h.beginPath(),h.strokeStyle=this.root.api.colLineColor,s&&this.root.api.colStartMonthLineColor&&(h.strokeStyle=this.root.api.colStartMonthLineColor),h.moveTo(o,n),h.lineTo(o,this.root.view.canvasHeight),h.stroke(),i?(h.fillStyle=this.root.api.dayTodayBackground,h.fillRect(o,n+a,this.root.grid.view.colWidth,this.root.view.canvasHeight)):r&&this.root.api.dayWeekendBackground&&(h.fillStyle=this.root.api.dayWeekendBackground,h.fillRect(o,n+a,this.root.grid.view.colWidth,this.root.view.canvasHeight))},t}(),e=function(){function t(t){this.root=t}return t.prototype.renderItem=function(t,e){var o=t.x,i=t.xx,r=t.title,s=t.middle,n=t.startMonthX,a=this.root.ctx;(a.beginPath(),a.strokeStyle=this.root.api.monthLineColor,this.root.api.renderMonthLeftLine&&(a.moveTo(o,0),a.lineTo(o,e)),this.root.api.renderMonthBottomLine&&(a.moveTo(o,e),a.lineTo(i,e)),a.stroke(),this.root.api.showMonthMiddle||-1!==["week","month","half-day","quarter-day","three-hours","hour"].indexOf(this.root.api.viewMode))&&(i-o>=1.5*a.measureText(r).width&&(s=(i+o)/2));if(this.root.api.showMonthFromStartOnDayView&&"day"===this.root.api.viewMode){if(!n&&0!==n)return;a.font=this.root.api.monthTitleFont,a.fillStyle=this.root.api.monthTitleColor,a.textAlign="left",a.textBaseline="middle",a.fillText(r,n,e/2),a.textBaseline="alphabetic"}else s&&(a.font=this.root.api.monthTitleFont,a.fillStyle=this.root.api.monthTitleColor,a.textAlign="center",a.textBaseline="middle",a.fillText(r,s,e/2),a.textAlign="left",a.textBaseline="alphabetic")},t}(),o=function(){function t(t){this.root=t}return t.prototype.renderItem=function(t,e){var o=t.y,i=t.odd,r=this.root.ctx;r.beginPath(),r.rect(0,o,this.root.view.canvasWidth,e),r.fillStyle=i?this.root.api.rowOddBackground:this.root.api.rowEvenBackground,r.fill(),r.beginPath(),r.strokeStyle=this.root.api.rowLineColor,r.moveTo(0,o+e),r.lineTo(this.root.view.canvasWidth,o+e),r.stroke()},t}(),i=function(){function i(i,r){this.columns=[],this.rows=[],this.months=[],this.firstTsOnScreen=0,this.dayTs=864e5,this.halfDayTs=432e5,this.quarterDayTs=216e5,this.threeHoursTs=108e5,this.hourTs=36e5,this.root=i,this.module=r,this.columnEntity=new t(i),this.monthEntity=new e(i),this.rowEntity=new o(i)}return Object.defineProperty(i.prototype,"colWidth",{get:function(){return-1!==["day","half-day","quarter-day","three-hours","hour"].indexOf(this.root.api.viewMode)?this.root.api.dayColWidth:"week"===this.root.api.viewMode?this.root.api.weekViewColWidth:this.root.api.monthViewColWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colsOnScreen",{get:function(){return this.root.view.canvasWidth/this.colWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"colTs",{get:function(){return"day"===this.root.api.viewMode?this.dayTs:"half-day"===this.root.api.viewMode?this.halfDayTs:"quarter-day"===this.root.api.viewMode?this.quarterDayTs:"three-hours"===this.root.api.viewMode?this.threeHoursTs:"hour"===this.root.api.viewMode?this.hourTs:"week"===this.root.api.viewMode?this.weekTs:this.monthTs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"weekTs",{get:function(){return 7*this.dayTs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"monthTs",{get:function(){return 30*this.dayTs},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tsHasOneX",{get:function(){return this.colTs/this.colWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rowHeight",{get:function(){return this.root.api.rowHeight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"monthHeight",{get:function(){return this.root.api.monthHeight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dayHeight",{get:function(){return this.root.api.dayHeight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"headerHeight",{get:function(){return this.monthHeight+this.dayHeight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rowsOffsetY",{get:function(){return this.monthHeight+this.dayHeight},enumerable:!1,configurable:!0}),i.prototype.fillColumns=function(){for(var t=this.root.view.offsetX,e=this.root.view.canvasWidth,o=this.module.store.dates.length,i=[],r=0;r<o;r++){var s=this.module.store.dates[r],n=r*this.colWidth-t;if(!(n<10*-this.colWidth)){if(n>e+this.colWidth)break;i.push({ts:s.ts,x:n,title:s.title,month:s.month,hour:s.hour,year:s.year,isStartMonth:s.isStartMonth,isMiddleDayMonth:s.isMiddleDayMonth,today:s.today,weekend:s.weekend,weekday:s.weekday,weekdayTitle:this.getWeekDayTitle(s.weekday)})}}this.columns=i},i.prototype.fillMonths=function(){var t=this,e="month"===this.root.api.viewMode,o=-1!==["half-day","quarter-day"].indexOf(this.root.api.viewMode),i=-1!==["three-hours","hour"].indexOf(this.root.api.viewMode),r=this.columns.reduce((function(r,s){var n=s.month,a=s.x,h=s.year,d=s.isMiddleDayMonth,l=s.title,u=s.isStartMonth,c=a+t.colWidth,f=n+"."+h;e?f=h:(o||i)&&(f=l+"."+n);var v=t.getMonthTitle(n,h);return e?v=h.toString():o?v=l+"."+t.getMonthNumber(n):i&&(v=l+" "+t.getMonthTitle(n)),r[f]?(r[f].x>a&&(r[f].x=a),r[f].xx<c&&(r[f].xx=c),d&&(r[f].middle=a+t.colWidth/2),r):(r[f]={title:v,x:a,xx:c},u&&(r[f].startMonthX=a),r)}),{});this.months=Object.values(r)},i.prototype.getMonthTitle=function(t,e){var o,i=null!==(o=this.root.api.monthNames[this.root.api.lang])&&void 0!==o?o:this.root.api.monthNames.ru;return this.root.api.monthTitleShowYear&&e?i[t]+" "+e:i[t]},i.prototype.getWeekDayTitle=function(t){var e;return this.root.api.showDayWeekday&&"day"===this.root.api.viewMode?(null!==(e=this.root.api.weekdayNames[this.root.api.lang])&&void 0!==e?e:this.root.api.weekdayNames.ru)[t]:""},i.prototype.getMonthNumber=function(t){return++t<10?"0"+t:t.toString()},i.prototype.fillRows=function(){var t=!0,e=this.root.view.canvasHeight,o=[],i=this.rowsOffsetY+this.rowHeight-this.root.view.offsetY-this.rowHeight,r=this.rowsOffsetY-this.rowHeight,s=Math.floor((-i+r)/this.rowHeight),n=0;do{if(n=s*this.rowHeight+i,t=++s%2==1,n>e)break;n<r||o.push({y:n,odd:t})}while(n<=e);this.rows=o},i.prototype.updateStore=function(){this.fillColumns(),this.fillRows(),this.fillMonths(),this.firstTsOnScreen=this.module.service.getFirstTsOnScreen()},i.prototype.renderGrid=function(){var t=this;this.updateStore(),this.rows.forEach((function(e){return t.rowEntity.renderItem(e,t.rowHeight)}));var e=this.getColumnCommonData();this.columns.forEach((function(o){return t.columnEntity.renderCol(o,e)}))},i.prototype.renderHeader=function(){var t=this,e=this.root.view.canvasWidth;this.root.ctx.fillStyle=this.root.api.background,this.root.ctx.rect(0,0,e,this.rowsOffsetY),this.root.ctx.fill();var o=this.getColumnCommonData();this.columns.forEach((function(e){return t.columnEntity.renderDay(e,o)})),this.months.forEach((function(e){return t.monthEntity.renderItem(e,t.monthHeight)}))},i.prototype.getColumnCommonData=function(){return{monthHeight:this.monthHeight,width:this.colWidth,dayHeight:this.dayHeight}},i}(),r={day:function(t,e){void 0===e&&(e=!1),e?t.setHours(23,59,59):t.setHours(0,0,0,0)},halfDay:function(t,e){void 0===e&&(e=!1),t.getHours()>=12?e?t.setHours(23,59,59):t.setHours(12,0,0,0):e?t.setHours(11,59,59):t.setHours(0,0,0,0)},quarterDay:function(t,e){void 0===e&&(e=!1);var o=t.getHours();o>=18?e?t.setHours(23,59,59):t.setHours(18,0,0,0):o>=12?e?t.setHours(17,59,59):t.setHours(12,0,0,0):o>=6?e?t.setHours(11,59,59):t.setHours(6,0,0,0):e?t.setHours(5,59,59):t.setHours(0,0,0,0)},threeHours:function(t,e){void 0===e&&(e=!1);var o=t.getHours();o>=21?e?t.setHours(23,59,59):t.setHours(21,0,0,0):o>=18?e?t.setHours(20,59,59):t.setHours(18,0,0,0):o>=15?e?t.setHours(17,59,59):t.setHours(15,0,0,0):o>=12?e?t.setHours(14,59,59):t.setHours(12,0,0,0):o>=9?e?t.setHours(11,59,59):t.setHours(9,0,0,0):o>=6?e?t.setHours(8,59,59):t.setHours(6,0,0,0):o>=3?e?t.setHours(5,59,59):t.setHours(3,0,0,0):e?t.setHours(2,59,59):t.setHours(0,0,0,0)},hour:function(t,e){void 0===e&&(e=!1);var o=t.getHours();e?t.setHours(o,59,59):t.setHours(o,0,0,0)}},s=function(t,e,o){void 0===e&&(e=!1),void 0===o&&(o="day");var i=t?new Date(t):new Date;return o&&r[o](i,e),i},n=function(t,e){return new Date(t.getTime()+e)},a=function(t,e){return new Date(e,t,0).getDate()},h=function(){function t(t,e){this.dates=[],this.todayTs=0,this.root=t,this.module=e}return t.prototype.initialData=function(){if(this.todayTs=s().getTime(),this.root.api.renderAllTasksFromStart){var t=this.root.tasks.service.getFirstAndLastDeadline(),e=t[0],o=t[1];e=this.getStartDayByViewMode(e);var i=s(e);this.add(i);do{i=n(i,this.getOffset(i)),this.add(i)}while(i.getTime()<=o)}this.addDatesBefore(this.root.view.offsetX),this.addDatesAfter(this.root.view.offsetX)},t.prototype.fillDataBefore=function(t){var e=s(this.dates[0].ts);if(e.getTime()>t)do{e=n(e,-this.getOffset(e,!0)),this.add(e,!0)}while(e.getTime()>t)},t.prototype.add=function(t,e){void 0===e&&(e=!1);var o=t.getDate(),i=!1,r=!1,n=!1,h=!1,d=t.getDay();"day"===this.root.api.viewMode&&(i=o===Math.floor(a(t.getMonth()+1,t.getFullYear())/2));-1!==["day","half-day","quarter-day","three-hours","hour"].indexOf(this.root.api.viewMode)&&(r=1===o&&0===t.getHours(),n=[0,6].includes(d),h=this.todayTs===s(t.getTime()).getTime());var l={ts:t.getTime(),title:t.getDate().toString(),month:t.getMonth(),year:t.getFullYear(),hour:t.getHours(),isStartMonth:r,weekend:n,weekday:d,isMiddleDayMonth:i,today:h};e?this.dates.unshift(l):this.dates.push(l)},t.prototype.addDatesBefore=function(t){var e;if(!(t>this.root.view.canvasWidth)){var o=this.dates,i=this.module.view,r=i.colsOnScreen,a=i.colWidth,h=-t/a,d=null===(e=o[0])||void 0===e?void 0:e.ts;d||(d=this.getStartDayByViewMode(s().getTime()));for(var l=s(d,!1,null),u=0;u<h+r;u++)t+=a,l=n(l,-this.getOffset(l,!0)),this.add(l,!0);this.root.view.offsetX=t}},t.prototype.addDatesAfter=function(t){var e,o=this.dates,i=this.module.service.getFullAvailableWidth(),r=this.module.view,a=r.colsOnScreen,h=r.colWidth,d=i-this.root.view.canvasWidth-h;if(!(t<d)){var l=(t-d)/h,u=null===(e=o[o.length-1])||void 0===e?void 0:e.ts;u||(u=this.getStartDayByViewMode(s().getTime()));for(var c=s(u,!1,null),f=0;f<l+a;f++)c=n(c,this.getOffset(c)),this.add(c)}},t.prototype.getStartDayByViewMode=function(t){var e=this.root.api.viewMode;if(-1!==["day","half-day","quarter-day","three-hours","hour"].indexOf(e))return t;var o=s(t),i=o.getDay();if(0===i&&(i=7),"month"===e&&(i=o.getDate()),1===i)return t;var r=(i-1)*this.module.view.dayTs;return(o=n(o,-r)).getTime()},t.prototype.getOffset=function(t,e){return void 0===e&&(e=!1),"month"===this.root.api.viewMode?e?a(t.getMonth(),t.getFullYear())*this.module.view.dayTs:a(t.getMonth()+1,t.getFullYear())*this.module.view.dayTs:this.module.view.colTs},t}(),d=function(){function t(t,e){this.root=t,this.module=e}return t.prototype.showDay=function(t,e,o,i){void 0===i&&(i=!0);var r=s(t);if(i){var n=this.module.view.colsOnScreen/3;"week"===this.root.api.viewMode?n*=7:"month"===this.root.api.viewMode?n*=30:"half-day"===this.root.api.viewMode?n/=2:"quarter-day"===this.root.api.viewMode?n/=4:("three-hours"===this.root.api.viewMode||"hour"===this.root.api.viewMode)&&(n=0),function(t,e){t.setDate(t.getDate()+e)}(r,-n)}var a=r.getTime();this.showDayByTs(a,e,o)},t.prototype.showDayByTs=function(t,e,o){var i=0,r=t-this.module.store.dates[0].ts;r>0?i=r/this.module.view.tsHasOneX:this.module.store.fillDataBefore(t),this.root.view.handleSetOffsetX(i,e,o)},t.prototype.getPosXByTs=function(t){return"month"===this.root.api.viewMode?this.getPosXForMonthView(t):this.getPosXByTsAndTsHasOneX(t)},t.prototype.getPosXByTsAndTsHasOneX=function(t){return(t-this.module.view.firstTsOnScreen)/this.module.view.tsHasOneX},t.prototype.getPosXForMonthView=function(t){var e=this.module.view.columns.find((function(e){return e.ts>t}));if(e){var o=this.module.view.columns.indexOf(e),i=this.module.view.columns[o-1];if(i){var r=(t-i.ts)/(e.ts-i.ts)*(e.x-i.x);return i.x+r}}return this.getPosXByTsAndTsHasOneX(t)},t.prototype.getPosXByFullDayTs=function(t,e,o){void 0===e&&(e=!1),void 0===o&&(o="day");var i=s(t,e,o);return this.getPosXByTs(i.getTime())},t.prototype.getFirstTsOnScreen=function(){var t=this.module.view.colWidth,e=this.module.view.columns.find((function(e){return e.x<=0&&e.x+t>0}));return e?e.ts+-e.x*this.module.view.tsHasOneX:0},t.prototype.getTsByOffsetDiff=function(t){var e=this.module.view.columns;return e.length?(e[1].ts-e[0].ts)*(t/this.module.view.colWidth):0},t.prototype.getFullAvailableWidth=function(){var t=this.root.view.canvasWidth,e=this.module.view.colWidth*this.module.store.dates.length;return e<t&&(e=t),e},t.prototype.getViewHeight=function(){return this.root.view.canvasHeight-this.root.grid.view.headerHeight-this.root.view.scrollbarY.bottomOffset},t.prototype.getFullAvailableHeight=function(){var t=this.module.view.rowHeight*this.root.api.tasks.length,e=this.getViewHeight();return t<e&&(t=e),t},t.prototype.getLeftAvailableHeight=function(){return this.root.grid.service.getFullAvailableHeight()-this.getViewHeight()},t.prototype.validateOffsetX=function(){var t=this.root.view.offsetX;t<this.root.view.canvasWidth?this.module.store.addDatesBefore(t):t>this.getFullAvailableWidth()-this.root.view.canvasWidth&&this.module.store.addDatesAfter(t)},t.prototype.getDayType=function(){return"half-day"===this.root.api.viewMode?"halfDay":"quarter-day"===this.root.api.viewMode?"quarterDay":"three-hours"===this.root.api.viewMode?"threeHours":"hour"===this.root.api.viewMode?"hour":"day"},t}(),l=function(){function t(t){this.root=t,this.store=new h(t,this),this.view=new i(t,this),this.service=new d(t,this)}return t.prototype.init=function(){this.store.dates=[],this.store.initialData(),this.root.api.startFromToday&&this.service.showDay()},t}(),u=function(){function t(t){this.modifiedTasks={},this.tasks=[],this.tasksList={},this.hoverId=null,this.hoverResize=null,this.hoverDrag=null,this.hoverConnectionTask=null,this.addDepOffsetX=null,this.addDepOffsetY=null,this.root=t}return t.prototype.fillTasks=function(){var t=this;this.tasks=this.root.api.tasks.map((function(e){return t.modifiedTasks[e.id]?t.modifiedTasks[e.id]:e})),this.tasksList={},this.tasks.forEach((function(e){t.tasksList[e.id]=e}))},t.prototype.clearModTasks=function(){this.modifiedTasks={}},t.prototype.saveModTasks=function(){this.root.api.updateTasks(this.tasks),this.clearModTasks()},t.prototype.addModTask=function(t){this.modifiedTasks[t.id]=t,this.fillTasks()},t.prototype.setHoverId=function(t,e,o){t===this.hoverId&&e===this.hoverResize&&o===this.hoverDrag||(this.root.api.isLoading||(t?this.root.view.setCursor(e?"col-resize":o?"grab":"pointer"):this.root.view.setCursor("auto")),this.hoverResize=e,this.hoverDrag=o,t!==this.hoverId&&(this.hoverId=t,this.root.render()))},t.prototype.setHoverConnectionTask=function(t){this.hoverConnectionTask=t},t.prototype.updateDepOffsets=function(t,e){void 0===t&&(t=this.addDepOffsetX),void 0===e&&(e=this.addDepOffsetY),this.addDepOffsetX=t,this.addDepOffsetY=e},t}(),c=function(){return c=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},c.apply(this,arguments)};function f(t,e,o){if(o||2===arguments.length)for(var i,r=0,s=e.length;r<s;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}var v=function(t,e,o,i,r,s,n,a){"number"==typeof s?s={tl:s,tr:s,br:s,bl:s}:"object"==typeof s&&Array.isArray(s)&&(s={tl:s[0],tr:s[1],br:s[2],bl:s[3]}),n&&(t.fillStyle=n),a&&(t.strokeStyle=a),t.beginPath(),t.moveTo(e+s.tl,o),t.lineTo(e+i-s.tr,o),t.quadraticCurveTo(e+i,o,e+i,o+s.tr),t.lineTo(e+i,o+r-s.br),t.quadraticCurveTo(e+i,o+r,e+i-s.br,o+r),t.lineTo(e+s.bl,o+r),t.quadraticCurveTo(e,o+r,e,o+r-s.bl),t.lineTo(e,o+s.tl),t.quadraticCurveTo(e,o,e+s.tl,o),t.closePath(),n&&t.fill(),a&&t.stroke(),t.beginPath(),t.closePath()},p=function(t,e,o){var i,r,s,n,a=e.getBoundingClientRect(),h=null!==(r=null===(i=t.changedTouches[0])||void 0===i?void 0:i.clientX)&&void 0!==r?r:0,d=null!==(n=null===(s=t.changedTouches[0])||void 0===s?void 0:s.clientY)&&void 0!==n?n:0,l=h-a.left,u=d-a.top,c=k(o);return{offsetX:Math.round(l*e.width/c/a.width),offsetY:Math.round(u*e.height/c/a.height)}},y=function(t,e,o,i){var r=g(t,e),s=Math.floor(1.4*r.actualHeight);switch(t.textAlign){case"center":o-=r.width/2;break;case"right":o-=r.width}switch(t.textBaseline){case"top":i+=s;break;case"middle":i+=s/2}t.save(),t.beginPath(),t.strokeStyle=t.fillStyle,t.lineWidth=Math.ceil(.04*s),t.moveTo(o,i),t.lineTo(o+r.width,i),t.stroke(),t.restore()},g=function(t,e){var o=t.measureText(e);return{width:Math.floor(o.width),height:Math.floor(o.fontBoundingBoxAscent+o.fontBoundingBoxDescent),actualHeight:Math.floor(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent)}};function k(t){return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function w(t,e,o,i){var r=k(e);1!==r?(t.width=o*r,t.height=i*r,t.style.width=o+"px",t.style.height=i+"px"):(t.width=o,t.height=i,t.style.width="",t.style.height=""),e.scale(r,r)}var m=function(){function t(t){this.root=t}return t.prototype.isHover=function(t,e){var o=e.x,i=e.y,r=e.w,s=e.noEditable,n=this.root.grid.view.rowHeight,a=t.offsetX,h=t.offsetY,d=null,l=null,u=this.getTaskXX(o,r),c=i+n;this.needControlOutsideTask(e)&&(o-=this.root.api.taskPadding+this.root.api.taskRenderResizeControlsWidth,u+=this.root.api.taskRenderResizeControlsWidth+this.root.api.taskPadding);var f=o<a&&a<u&&i<h&&h<c;return f?(s||(this.root.api.taskRenderDepControl&&u-this.root.api.taskRenderDepRadius-this.getDepOffsetX()<a?l=!0:d=this.isControlsHover(t,e)),{hover:f,resize:d,depFrom:l}):{hover:f,resize:d,depFrom:l}},t.prototype.renderItem=function(t,e){void 0===e&&(e=!1);var o=t.x,i=t.y,r=t.w,s=t.hover,n=t.noEditable;if(!(o>=this.root.view.canvasWidth||0===r)){var a=this.root.ctx;a.beginPath();var h=this.getTaskTop(i),d=this.getTaskFillStyle(t),l=this.getTaskStrokeStyle(t);v(a,o,h,r,this.root.api.taskHeight,this.root.api.taskRadius,d,l),this.renderTaskText(t,h),s&&!n&&(e&&!this.root.api.allowMobileTaskResize||this.renderResizeControls(t,h),e||this.renderRightDep(o+r,h+this.root.api.taskHeight/2))}},t.prototype.renderRightDep=function(t,e){if(this.root.api.taskRenderDepControl){var o=this.root.ctx;o.beginPath(),o.fillStyle=this.root.api.taskRenderDepBackground,o.arc(t+this.getDepOffsetX(),e,this.root.api.taskRenderDepRadius,0,2*Math.PI),o.strokeStyle=this.root.api.taskRenderDepLineColor,o.lineWidth=this.root.api.taskRenderDepLineWidth,o.stroke(),o.fill(),o.lineWidth=1}},t.prototype.renderArrow=function(t,e){var o=this.root.grid.view.rowHeight,i=this.root.tasks.service.getRenderedViewTaskById(t)||this.root.tasks.service.getViewTaskById(t);if(i){var r=e.x+e.w,s=e.y+o/2,n=i.hover||e.hover;n&&this.renderArrowLine(r,s,i,n,!0),this.renderArrowLine(r,s,i,n,!1)}},t.prototype.renderArrowLine=function(t,e,o,i,r){var s=this.root.ctx,n=this.root.api.arrowRadius,a=this.root.grid.view.rowHeight,h=this.getDepOffsetX()||10,d=o.y+a/2;s.strokeStyle=this.root.api.arrowColor,s.fillStyle=this.root.api.arrowColor;var l=s.lineWidth;s.lineWidth=this.root.api.arrowWidth,r?(s.strokeStyle="#fff",s.fillStyle="#fff"):i&&(s.strokeStyle=this.root.api.arrowHoverColor,s.fillStyle=this.root.api.arrowHoverColor,s.lineWidth=this.root.api.arrowHoverWidth),o.x>=t+2*h?(s.beginPath(),s.moveTo(t,e),s.lineTo(t+h-n,e),s.quadraticCurveTo(t+h,e,t+h,d<e?e-n:e+n),s.lineTo(t+h,d>e?d-n:d+n),s.quadraticCurveTo(t+h,d,t+h+n,d),s.lineTo(o.x-s.lineWidth,d),s.stroke(),this.renderArrowHead(t+h,d,o.x,d,i)):(s.beginPath(),s.moveTo(t,e),s.lineTo(t+h-n,e),s.quadraticCurveTo(t+h,e,t+h,e+n),s.lineTo(t+h,e+a/2-n),s.quadraticCurveTo(t+h,e+a/2,t+h-n,e+a/2),s.lineTo(o.x-20+n,e+a/2),s.quadraticCurveTo(o.x-20,e+a/2,o.x-20,d>e?e+a/2+n:e+a/2-n),s.lineTo(o.x-20,d),s.lineTo(o.x-s.lineWidth,d),s.stroke(),this.renderArrowHead(o.x-20,d,o.x,d,i)),s.lineWidth=l},t.prototype.renderArrowConnection=function(t,e,o){var i=this.root.tasks.service.getRenderedViewTaskById(t)||this.root.tasks.service.getViewTaskById(t);if(i){var r=this.root.grid.view.rowHeight,s=i.y+r/2,n=i.x+i.w,a=this.root.ctx;a.strokeStyle=this.root.api.arrowActiveColor,a.fillStyle=this.root.api.arrowActiveColor;var h=this.getDepOffsetX();i.x+i.w+this.root.api.taskRenderDepRadius>e?(a.beginPath(),a.moveTo(n,s),a.lineTo(n+h,s),a.lineTo(n+h,o+r/2),a.lineTo(e-20,o+r/2),a.lineTo(e-20,o),a.lineTo(e,o),a.stroke(),this.renderArrowHead(e-20,o,e,o)):(a.beginPath(),a.moveTo(n,s),a.lineTo(n+h,s),a.lineTo(n+h,o),a.lineTo(e,o),a.stroke(),this.renderArrowHead(e-20,o,e,o))}},t.prototype.renderArrowHead=function(t,e,o,i,r){void 0===r&&(r=!1);var s=this.root.ctx,n=s.lineWidth;r?(s.lineWidth=this.root.api.arrowHoverHeadWidth,o-=this.root.api.arrowHoverHeadWidth):(s.lineWidth=this.root.api.arrowWidth,o-=this.root.api.arrowWidth);var a=10*this.root.api.scale,h=Math.atan2(i-e,o-t);s.beginPath(),s.moveTo(o,i),s.lineTo(o-a*Math.cos(h-Math.PI/7),i-a*Math.sin(h-Math.PI/7)),s.lineTo(o-a*Math.cos(h+Math.PI/7),i-a*Math.sin(h+Math.PI/7)),s.lineTo(o,i),s.lineTo(o-a*Math.cos(h-Math.PI/7),i-a*Math.sin(h-Math.PI/7)),s.stroke(),s.fill(),s.lineWidth=n},t.prototype.renderTaskText=function(t,e){var o,i,r=t.x,s=t.w,n=t.title,a=t.subtitle,h=t.hover,d=t.colorSubtitle,l=this.root.service.convertColor,u=this.root.ctx,c=this.root.api,f=c.taskFont,v=c.taskPadding,p=c.taskRenderResizeControls,g=c.taskRenderResizeControlsWidth,k=c.taskHeight,w=c.taskDefaultOutlineColor,m=c.taskDefaultSubtitleColor,T=c.taskDefaultSubtitleOutlineColor,b=c.taskRenderDepRadius,M=c.taskSubtitleOffset;u.font=f,u.textAlign="center",u.textBaseline="middle";var C=s-2*v;p&&(C-=2*g+2*v);var D=u.measureText(n).width;if(D+(a?u.measureText(a).width+M:0)<C){u.fillStyle=this.getTitleColor(t),u.textAlign="left";var O=r+2*v+g;u.fillText(n,O,e+k/2),t.underline&&y(u,n,O,e+k/4),a&&h&&(u.fillStyle=l(null!=d?d:m),u.fillText(a,O+D+M,e+k/2),t.underline&&y(u,a,O+D+M,e+k/4))}else{u.fillStyle=l(null!==(o=t.outlineColor)&&void 0!==o?o:w),u.textAlign="left";O=r+s+this.getDepOffsetX()+2*b;u.fillText(n,O,e+k/2),t.underline&&y(u,n,O,e+k/4),a&&h&&(u.fillStyle=l(null!==(i=t.outlineSubtitleColor)&&void 0!==i?i:T),u.fillText(a,O+D+M,e+k/2),t.underline&&y(u,a,O+D+M,e+k/4))}},t.prototype.renderResizeControls=function(t,e){if(this.root.api.taskRenderResizeControls&&!this.needControlOutsideTask(t)){var o=t.x,i=t.w,r=this.root.ctx,s=o+this.root.api.taskPadding;e+=this.root.api.taskPadding;var n=this.root.api.taskRenderResizeControlsWidth,a=this.root.api.taskHeight-2*this.root.api.taskPadding,h=o+i-n-this.root.api.taskPadding,d=this.root.api.taskRenderResizeControlsColor;v(r,s,e,n,a,this.root.api.taskRenderResizeControlsRadius,d),v(r,h,e,n,a,this.root.api.taskRenderResizeControlsRadius,d)}},t.prototype.isControlsHover=function(t,e){if(this.root.api.taskRenderResizeControls&&!this.needControlOutsideTask(e))return this.isRenderedControlsHover(t,e);var o=t.offsetX,i=e.x,r=e.w,s=.2*r;return s>30&&(s=30),i+s>o?"left":i+r-s<o?"right":null},t.prototype.isRenderedControlsHover=function(t,e){var o=t.offsetX,i=t.offsetY,r=e.x,s=e.y,n=e.w,a=this.getTaskTop(s)+this.root.api.taskPadding,h=a+this.root.api.taskHeight-2*this.root.api.taskPadding;if(i<a||i>h)return null;var d=this.root.api.taskRenderResizeControlsWidth,l=r+this.root.api.taskPadding;if(o>l&&o<l+d)return"left";var u=r+n-d-this.root.api.taskPadding;return o>u&&o<u+d?"right":null},t.prototype.getTaskTop=function(t){return(this.root.grid.view.rowHeight-this.root.api.taskHeight)/2+t},t.prototype.getTaskXX=function(t,e){var o=t+e;return this.root.api.taskRenderDepControl&&(o+=this.getDepOffsetX()+this.root.api.taskRenderDepRadius),o},t.prototype.getDepOffsetX=function(){return this.root.api.taskRenderDepControl?this.root.api.taskRenderDepRadius+this.root.api.taskRenderDepOffsetX:0},t.prototype.getTaskFillStyle=function(t){var e=t.hover,o=t.hoverConnection,i=t.background,r=t.backgroundHover,s=this.root.service.convertColor;return s(e||o?null!=r?r:this.root.api.taskDefaultHoverBackground:null!=i?i:this.root.api.taskDefaultBackground)},t.prototype.getTaskStrokeStyle=function(t){var e=t.hover,o=t.hoverConnection,i=t.error,r=t.stroke,s=t.strokeHover,n=this.root.api,a=n.taskErrorStrokeColor,h=n.taskDefaultStrokeColor,d=n.taskDefaultHoverStrokeColor,l=this.root.service.convertOptionalColor;return i&&a?a:l(e||o?null!=s?s:d:null!=r?r:h)},t.prototype.getTitleColor=function(t){var e=t.hover,o=t.hoverConnection,i=t.color,r=t.colorHover,s=this.root.service.convertColor;return s(e||o?null!=r?r:this.root.api.taskDefaultHoverColor:null!=i?i:this.root.api.taskDefaultColor)},t.prototype.needControlOutsideTask=function(t){return 2*(this.root.api.taskRenderResizeControlsWidth+this.root.api.taskPadding)>t.w},t}(),T=function(){function t(t,e){this.tasksForArrows=[],this.tasks=[],this.root=t,this.module=e,this.taskEntity=new m(t)}return t.prototype.fillTasks=function(){var t=this,e=this.root.grid.view,o=e.rowHeight,i=e.rowsOffsetY,r=this.module.store,s=r.hoverId,n=r.hoverConnectionTask,a=r.tasks,h=i-this.root.view.offsetY,d={},l=this.root.grid.service.getDayType();a.forEach((function(e,i){var r=t.module.service.getTaskPos(e,l),a=r.x,u=r.xx,f=r.error,v=u-a;v<t.root.api.minTaskWidth&&(v=t.root.api.minTaskWidth);var p=o*i+h;d[e.id]=c(c({},e),{hover:s===e.id,hoverConnection:n===e.id,y:p,x:a,w:v,error:f})})),this.tasksForArrows=Object.values(d).filter((function(e){return e.y+o>=i&&e.y<=t.root.view.canvasHeight&&e.x+e.w>=0&&e.x<=t.root.view.canvasWidth||e.next_ids.some((function(o){var r=d[o];return!!r&&(!(e.y<i&&r.y<i)&&(!(e.y>t.root.view.canvasHeight&&r.y>t.root.view.canvasHeight)&&(!(e.x+e.w<0&&r.x+r.w<0)&&!(e.x>t.root.view.canvasWidth&&r.x>t.root.view.canvasWidth))))}))})),this.tasks=this.tasksForArrows.filter((function(e){return e.y+o>=i&&e.y<=t.root.view.canvasHeight}))},t.prototype.render=function(){this.module.store.fillTasks(),this.fillTasks(),this.renderArrows(),this.renderArrowConnection(),this.renderTasks()},t.prototype.renderArrows=function(){var t=this,e=this.tasksForArrows.find((function(t){return t.hover}));this.tasksForArrows.forEach((function(o){o.next_ids.forEach((function(i){return(!e||e.id!==i)&&t.taskEntity.renderArrow(i,o)}))})),e&&(this.tasksForArrows.forEach((function(o){o.next_ids.forEach((function(i){return e.id===i&&t.taskEntity.renderArrow(i,o)}))})),e.next_ids.forEach((function(o){return t.taskEntity.renderArrow(o,e)})))},t.prototype.renderArrowConnection=function(){this.module.store.hoverId&&this.module.controller.addDepMode&&this.taskEntity.renderArrowConnection(this.module.store.hoverId,this.module.store.addDepOffsetX||0,this.module.store.addDepOffsetY||0)},t.prototype.renderTasks=function(){var t=this;this.tasks.forEach((function(e){return t.taskEntity.renderItem(e,t.module.controller.isTouchAction)}))},t}(),b=function(){function t(t,e){var o=this;this.addDepMode=!1,this.resizeMoveMode=null,this.mouseDownOffsetX=null,this.moveOffsetX=0,this.initialMouseDownOffsetX=null,this.isTouchAction=!1,this.handleTouchStart=function(t){var e=p(t,o.root.canvas,o.root.ctx);if(!o.root.api.isLoading){var i=o.module.service.getHoverId(e),r=i.hoverId,s=i.resize,n=i.depFromId;if(r){if(o.initialMouseDownOffsetX=e.offsetX,o.module.service.isNoEditableTask(r))return document.addEventListener("touchend",o.handleNoEditableTaskMouseUp);(s&&o.root.api.allowMobileTaskResize||o.root.api.allowMobileTaskMove)&&(o.mouseDownOffsetX=e.offsetX,o.isTouchAction=!0,o.module.store.setHoverId(r,s,n)),s&&o.root.api.allowMobileTaskResize?(o.resizeMoveMode=s,o.destroyResizeMove=o.root.controller.on("touchmove",o.handleResizeTaskTouchMove.bind(o)),document.addEventListener("touchend",o.handleResizeTouchEnd)):o.root.api.allowMobileTaskMove&&(o.destroyTaskMove=o.root.controller.on("touchmove",o.handleTaskTouchMove.bind(o)),document.addEventListener("touchend",o.handleTaskMoveTouchEnd))}}},this.root=t,this.module=e,this.handleResizeMouseUp=this.handleResizeMouseUp.bind(this),this.handleResizeTouchEnd=this.handleResizeTouchEnd.bind(this),this.handleTaskMoveMouseUp=this.handleTaskMoveMouseUp.bind(this),this.handleTaskMoveTouchEnd=this.handleTaskMoveTouchEnd.bind(this),this.handleAddDepMouseUp=this.handleAddDepMouseUp.bind(this),this.handleNoEditableTaskMouseUp=this.handleNoEditableTaskMouseUp.bind(this)}return t.prototype.attachEvents=function(){this.root.controller.on("mousedown",this.handleMouseDown.bind(this)),(this.root.api.allowMobileTaskMove||this.root.api.allowMobileTaskResize)&&this.root.controller.on("touchstart",this.handleTouchStart.bind(this)),this.root.controller.on("mousemove",this.handleMouseMove.bind(this)),this.root.controller.on("mouseup",this.handleMouseUp.bind(this)),this.root.controller.on("touchend",this.handleTouchEnd.bind(this))},t.prototype.destroyEvents=function(){document.removeEventListener("mouseup",this.handleResizeMouseUp),document.removeEventListener("mouseup",this.handleAddDepMouseUp),document.removeEventListener("mouseup",this.handleTaskMoveMouseUp),document.removeEventListener("mouseup",this.handleNoEditableTaskMouseUp)},t.prototype.handleTouchEnd=function(t){var e=p(t,this.root.canvas,this.root.ctx);(this.initialMouseDownOffsetX===e.offsetX||this.root.api.isLoading)&&this.module.service.handleClickTask(e)},t.prototype.handleMouseDown=function(t){if(!this.root.api.isLoading){var e=this.module.service.getHoverId(t),o=e.hoverId,i=e.resize,r=e.depFromId;o&&(this.initialMouseDownOffsetX=t.offsetX,this.mouseDownOffsetX=t.offsetX,this.module.service.isNoEditableTask(o)?document.addEventListener("mouseup",this.handleNoEditableTaskMouseUp):r?(this.addDepMode=!0,this.destroyAddDepMove=this.root.controller.on("mousemove",this.handleAddDepMouseMove.bind(this)),document.addEventListener("mouseup",this.handleAddDepMouseUp)):i?(this.resizeMoveMode=i,this.destroyResizeMove=this.root.controller.on("mousemove",this.handleResizeTaskMouseMove.bind(this)),document.addEventListener("mouseup",this.handleResizeMouseUp)):(this.destroyTaskMove=this.root.controller.on("mousemove",this.handleTaskMove.bind(this)),document.addEventListener("mouseup",this.handleTaskMoveMouseUp)))}},t.prototype.handleMouseMove=function(t){if(!this.resizeMoveMode){if(this.mouseDownOffsetX&&!this.root.api.isLoading){var e=this.module.service.getHoverId(t).hoverId;return this.module.store.setHoverConnectionTask(e)}this.updateHoverId(t)}},t.prototype.updateHoverId=function(t){var e=this.module.service.getHoverId(t),o=e.hoverId,i=e.resize,r=e.depFromId;this.module.store.setHoverId(o,i,r)},t.prototype.handleResizeTaskMouseMove=function(t){this.shouldSkipMove(t.offsetX)||(this.moveOffsetX=t.offsetX,this.module.service.handleResizeTaskMouseMove(t))},t.prototype.handleResizeTaskTouchMove=function(t){var e=p(t,this.root.canvas,this.root.ctx);this.shouldSkipMove(e.offsetX,35)||(this.moveOffsetX=e.offsetX,this.module.service.handleResizeTaskMouseMove(e))},t.prototype.handleResizeMouseUp=function(t){this.handleResizeEnd(),this.updateHoverId(t),document.removeEventListener("mouseup",this.handleResizeMouseUp)},t.prototype.handleResizeTouchEnd=function(){this.handleResizeEnd(),this.module.store.setHoverId(null,null,null),document.removeEventListener("mouseup",this.handleResizeMouseUp)},t.prototype.handleResizeEnd=function(){this.module.service.handleResizeTaskMouseUp(),this.resizeMoveMode=null,this.mouseDownOffsetX=null,this.initialMouseDownOffsetX=null,this.isTouchAction=!1,this.destroyResizeMove&&this.destroyResizeMove()},t.prototype.handleAddDepMouseMove=function(t){this.module.service.handleAddDepMouseMove(t)},t.prototype.handleAddDepMouseUp=function(t){this.mouseDownOffsetX=null,this.initialMouseDownOffsetX=null,this.addDepMode=!1,this.isTouchAction=!1,this.module.service.handleAddDepMouseUp(t),this.destroyAddDepMove&&this.destroyAddDepMove(),this.updateHoverId(t),document.removeEventListener("mouseup",this.handleAddDepMouseUp)},t.prototype.handleTaskMove=function(t){this.shouldSkipMove(t.offsetX)||(this.moveOffsetX=t.offsetX,this.module.service.handleMoveTaskMouseMove(t))},t.prototype.handleTaskTouchMove=function(t){var e=p(t,this.root.canvas,this.root.ctx);this.shouldSkipMove(e.offsetX,35)||(this.moveOffsetX=e.offsetX,this.module.service.handleMoveTaskMouseMove(e))},t.prototype.shouldSkipMove=function(t,e){return void 0===e&&(e=5),t>this.moveOffsetX-e&&t<this.moveOffsetX+e},t.prototype.handleTaskMoveMouseUp=function(t){this.handleTaskMoveEnd(),this.updateHoverId(t),document.removeEventListener("mouseup",this.handleTaskMoveMouseUp)},t.prototype.handleTaskMoveTouchEnd=function(){this.handleTaskMoveEnd(),this.module.store.setHoverId(null,null,null),document.removeEventListener("touchend",this.handleTaskMoveTouchEnd)},t.prototype.handleTaskMoveEnd=function(){this.module.service.handleMoveTaskMouseUp(),this.destroyTaskMove&&this.destroyTaskMove(),this.mouseDownOffsetX=null,this.initialMouseDownOffsetX=null,this.isTouchAction=!1,this.module.store.setHoverConnectionTask(null)},t.prototype.handleNoEditableTaskMouseUp=function(){this.mouseDownOffsetX=null,this.module.store.setHoverConnectionTask(null)},t.prototype.handleMouseUp=function(t){(this.initialMouseDownOffsetX===t.offsetX||this.root.api.isLoading)&&this.module.service.handleClickTask(t)},t}(),M=function(){function t(t,e){this.intervalChangeOffset=null,this.scrollXOffset=null,this.root=t,this.module=e}return t.prototype.getRootStoreTaskById=function(t){return t&&this.root.api.tasks.find((function(e){return e.id===t}))||null},t.prototype.getModuleStoreTaskById=function(t){return this.module.store.tasksList[t]||null},t.prototype.getRenderedViewTaskById=function(t){return this.module.view.tasks.find((function(e){return e.id===t}))||null},t.prototype.getViewTaskById=function(t){var e=this.root.grid.view,o=e.rowHeight,i=e.rowsOffsetY,r=this.module.store.hoverId,s=this.root.grid.service.getDayType(),n=this.getModuleStoreTaskById(t);if(!n)return null;var a=this.module.store.tasks.indexOf(n),h=this.getTaskPos(n,s),d=h.x,l=h.xx,u=h.error,f=l-d,v=o*a+(i-this.root.view.offsetY);return c(c({},n),{hover:r===n.id,hoverConnection:this.module.store.hoverConnectionTask===t,y:v,x:d,w:f,error:u})},t.prototype.getStoreDependedTasksById=function(t,e){var o=this;void 0===e&&(e=[]);var i=this.getRootStoreTaskById(t);return i?(e.push(i),i.next_ids.forEach((function(t){e.find((function(e){return e.id===t}))||(e=o.getStoreDependedTasksById(t,e))})),e):e},t.prototype.getHoveredTask=function(){return this.getRootStoreTaskById(this.module.store.hoverId)},t.prototype.getTaskPos=function(t,e){void 0===e&&(e="day");var o=t.all_day||!this.root.api.showTime,i=o?this.root.grid.service.getPosXByFullDayTs(t.start_date_ts,!1,e):this.root.grid.service.getPosXByTs(t.start_date_ts),r=o?this.root.grid.service.getPosXByFullDayTs(t.end_date_ts,!0,e):this.root.grid.service.getPosXByTs(t.end_date_ts),s=!1,n=this.root.api.minTaskWidth;return r<i&&(s=!0),n&&r-n<i&&(r=i+n),{x:i,xx:r,error:s}},t.prototype.getFirstTaskByDeadline=function(){return this.root.api.tasks.reduce((function(t,e){return t?t.start_date_ts>e.start_date_ts?e:t:e}),this.root.api.tasks[0])},t.prototype.getLastTaskByDeadline=function(){return this.root.api.tasks.reduce((function(t,e){return t?t.end_date_ts<e.end_date_ts?e:t:e}),this.root.api.tasks[0])},t.prototype.getFirstDeadline=function(){var t,e=this.getFirstTaskByDeadline();return null!==(t=null==e?void 0:e.start_date_ts)&&void 0!==t?t:0},t.prototype.getLastDeadline=function(){var t,e=this.getLastTaskByDeadline();return null!==(t=null==e?void 0:e.end_date_ts)&&void 0!==t?t:0},t.prototype.getFirstAndLastDeadline=function(){return[this.getFirstDeadline(),this.getLastDeadline()]},t.prototype.isNoEditableTask=function(t){var e=this.getRootStoreTaskById(t);return!!e&&e.noEditable},t.prototype.getHoverId=function(t){for(var e=null,o=null,i=null,r=this.module.view,s=r.tasks,n=r.taskEntity,a=0,h=s;a<h.length;a++){var d=h[a],l=n.isHover(t,d);if(l.depFrom&&(i=d.id),l.resize&&(o=l.resize),l.hover){e=d.id;break}}return{hoverId:e,resize:o,depFromId:i}},t.prototype.scrollX=function(t){var e=this,o=t.offsetX,i=this.root.view.canvasWidth,r=this.root.grid.view.colWidth,s=o/i,n=0;s>.9&&this.scrollXOffset&&o>this.scrollXOffset?n=r:s<.1&&this.scrollXOffset&&o<this.scrollXOffset&&(n=-r),this.scrollXOffset=o;var a="month"===this.root.api.viewMode?132:66;0===n||this.intervalChangeOffset?0===n&&this.clearScrollInterval():this.intervalChangeOffset=setInterval((function(){e.module.controller.mouseDownOffsetX=(e.module.controller.mouseDownOffsetX||0)-n,e.module.controller.addDepMode?e.updateDepOffsets(o):e.module.controller.resizeMoveMode?e.resizeTaskByResizeMode(o):e.moveTask(o),e.root.view.handleChangeOffsetX(n)}),a)},t.prototype.clearScrollInterval=function(){this.intervalChangeOffset&&(clearInterval(this.intervalChangeOffset),this.intervalChangeOffset=null)},t.prototype.getDiff=function(t,e){void 0===e&&(e=!1);var o=t-(this.module.controller.mouseDownOffsetX||0),i=this.root.grid.service.getTsByOffsetDiff(o);if(e||!this.root.api.showTime){var r=this.getColTsForDiff(e);i=r*((i-i%r)/r)}return i},t.prototype.getColTsForDiff=function(t){if(void 0===t&&(t=!1),!t&&!this.root.api.showTime){if("half-day"===this.root.api.viewMode)return this.root.grid.view.halfDayTs;if("quarter-day"===this.root.api.viewMode)return this.root.grid.view.quarterDayTs;if("three-hours"===this.root.api.viewMode)return this.root.grid.view.threeHoursTs;if("hour"===this.root.api.viewMode)return this.root.grid.view.hourTs}return this.root.grid.view.dayTs},t.prototype.handleClickTask=function(t){if(this.root.api.handleTaskClick){var e=this.getHoverId(t),o=e.hoverId,i=e.depFromId;if(o&&!i){var r=this.getRootStoreTaskById(o);r&&this.root.api.handleTaskClick(r)}}},t.prototype.scrollToTask=function(t){this.scrollToTaskX(t),this.scrollToTaskY(t)},t.prototype.scrollToTaskX=function(t){var e=this.getRootStoreTaskById(t);e&&this.root.grid.service.showDay(e.start_date_ts,!0,!0)},t.prototype.scrollToTaskY=function(t){var e=this.getViewTaskById(t);if(e){var o=this.root.view.offsetY-this.root.grid.view.rowsOffsetY,i=this.root.grid.service.getLeftAvailableHeight(),r=e.y+o;r>i&&(r=i),this.root.view.handleSetOffsetY(r,!0,!0)}},t.prototype.handleAddDepMouseMove=function(t){if(this.intervalChangeOffset)return this.updateDepOffsets(void 0,t.offsetY),this.scrollX(t);this.updateDepOffsets(t.offsetX,t.offsetY),this.scrollX(t),this.root.render()},t.prototype.handleAddDepMouseUp=function(t){var e=this.getHoverId(t).hoverId;if(e&&this.module.store.hoverId&&e!==this.module.store.hoverId){var o=this.getRootStoreTaskById(e),i=this.getRootStoreTaskById(this.module.store.hoverId);if(o&&i&&!i.next_ids.includes(e)){var r=c(c({},i),{next_ids:f(f([],i.next_ids),[e])});this.module.store.addModTask(r),this.module.store.saveModTasks(),this.root.api.handleChange&&this.root.api.handleChange([r])}}this.clearScrollInterval(),this.module.store.updateDepOffsets(null,null),this.module.store.setHoverConnectionTask(null),e&&e===this.module.store.hoverId&&this.root.render()},t.prototype.updateDepOffsets=function(t,e){this.module.store.updateDepOffsets(t,e)},t.prototype.handleResizeTaskMouseMove=function(t){if(this.intervalChangeOffset)return this.scrollX(t);this.resizeTaskByResizeMode(t.offsetX),this.scrollX(t),this.root.render()},t.prototype.resizeTaskByResizeMode=function(t){var e=this.module.controller.resizeMoveMode,o=this.getHoveredTask();if(o){var i=this.getDiff(t,o.all_day);"right"===e?this.resizeTaskRightSide(o,i):"left"===e&&this.resizeTaskLeftSide(o,i)}},t.prototype.resizeTaskRightSide=function(t,e){this.root.api.moveDependedOnResizeRight?this.saveResizeDependedTasksRightSide(t,e):this.saveResizeCurrentTaskRight(t,e)},t.prototype.resizeTaskLeftSide=function(t,e){this.root.api.moveDependedOnResizeLeft?this.saveResizeDependedTasksLeftSide(t,e):this.saveResizeCurrentTaskLeft(t,e)},t.prototype.saveResizeDependedTasksRightSide=function(t,e){var o=this;this.getStoreDependedTasksById(t.id).forEach((function(i){i.id===t.id?o.saveResizeCurrentTaskRight(i,e):o.saveMoveTask(i,e)}))},t.prototype.saveResizeCurrentTaskRight=function(t,e){var o=c(c({},t),{end_date_ts:t.end_date_ts+e});if(o.start_date_ts>o.end_date_ts)if(t.all_day){var i=Math.floor((o.start_date_ts-o.end_date_ts)/this.root.grid.view.dayTs)+1,r=new Date(o.start_date_ts);r.setDate(r.getDate()-i),o.start_date_ts=r.getTime()}else o.start_date_ts=o.end_date_ts;this.module.store.addModTask(o)},t.prototype.saveResizeDependedTasksLeftSide=function(t,e){var o=this;this.getStoreDependedTasksById(t.id).forEach((function(i){i.id===t.id?o.saveResizeCurrentTaskLeft(i,e):o.saveMoveTask(i,e)}))},t.prototype.saveResizeCurrentTaskLeft=function(t,e){var o=c(c({},t),{start_date_ts:t.start_date_ts+e});if(o.start_date_ts>o.end_date_ts)if(t.all_day){var i=Math.floor((o.start_date_ts-o.end_date_ts)/this.root.grid.view.dayTs)+1,r=new Date(o.end_date_ts);r.setDate(r.getDate()+i),o.end_date_ts=r.getTime()}else o.end_date_ts=o.start_date_ts;this.module.store.addModTask(o)},t.prototype.handleResizeTaskMouseUp=function(){var t=Object.values(this.module.store.modifiedTasks);this.root.api.handleChange&&this.root.api.handleChange(t),this.clearScrollInterval(),this.module.store.saveModTasks()},t.prototype.handleMoveTaskMouseMove=function(t){if(this.intervalChangeOffset)return this.scrollX(t);this.moveTask(t.offsetX),this.scrollX(t),this.root.render()},t.prototype.moveTask=function(t){var e=this.getHoveredTask();if(e&&this.module.controller.mouseDownOffsetX){var o=this.getDiff(t,e.all_day);this.root.api.moveDependedOnMove?this.moveDependedTasks(e,o):this.saveMoveTask(e,o)}},t.prototype.moveDependedTasks=function(t,e){var o=this;this.getStoreDependedTasksById(t.id).forEach((function(t){return o.saveMoveTask(t,e)}))},t.prototype.saveMoveTask=function(t,e){if(!t.noEditable){var o=c(c({},t),{start_date_ts:t.start_date_ts+e,end_date_ts:t.end_date_ts+e});this.module.store.addModTask(o)}},t.prototype.handleMoveTaskMouseUp=function(){var t=Object.values(this.module.store.modifiedTasks);this.root.api.handleChange&&this.root.api.handleChange(t),this.clearScrollInterval(),this.module.store.saveModTasks()},t}(),C=function(){function t(t){this.root=t,this.store=new u(t),this.service=new M(t,this),this.view=new T(t,this),this.controller=new b(t,this)}return t.prototype.init=function(){this.controller.attachEvents()},t.prototype.destroy=function(){this.controller.destroyEvents()},t}(),D=function(t){var e=this;this.convertColorDiv=null,this.colorsCache={},this.clearColorsCache=function(){e.colorsCache={}},this.convertOptionalColor=function(t){if(t)return e.convertColor(t)},this.convertColor=function(t,o){if(!t.includes("var"))return t;if(e.colorsCache[t])return e.colorsCache[t];e.convertColorDiv||(e.convertColorDiv=document.createElement("div"),e.root.root.appendChild(e.convertColorDiv)),e.convertColorDiv.style.color=t;var i=window.getComputedStyle(e.convertColorDiv,null).getPropertyValue("color");return!i&&o?o:i},this.unmountConvertColorDiv=function(){e.convertColorDiv&&(e.root.root.removeChild(e.convertColorDiv),e.convertColorDiv=null)},this.root=t},O="#fff",H="#222",S="#EAEAEA",R="#ccc",L="#f8fdff",_="#283593",X="#001064",x="#ae52d4",B="#7b1fa2",W={ru:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],en:["January","February","March","April","May","June","July","August","September","October","November","December"]},P={ru:["вс","пн","вт","ср","чт","пт","сб"],en:["su","mo","tu","we","th","fr","sa"]};function E(t){var e=performance.now();requestAnimationFrame((function o(i){var r=(i-e)/t.duration;r>1&&(r=1);var s=t.timing(r);t.draw(s),r<1&&requestAnimationFrame(o)}))}var z=function(t){return function(e){return 1-t(1-e)}}((function(t){return 1-Math.sin(Math.acos(t))}));var A=function(){function t(t,e){var o,i,r,s,n,a,h,d,l,u,f,v,p,y,g,k,w,m,T,b,M,C,D,E,z,A,F,Y,I,j,U,V,q,N,J,G,K,Q,Z,$,tt,et,ot,it,rt,st,nt,at,ht,dt,lt,ut,ct,ft,vt,pt,yt,gt,kt,wt,mt,Tt,bt,Mt,Ct,Dt,Ot,Ht,St,Rt,Lt,_t,Xt,xt,Bt,Wt,Pt,Et,zt,At,Ft,Yt,It,jt,Ut,Vt,qt,Nt;this.root=t,this.tasks=e.tasks,this.moveDependedOnResizeRight=null===(o=e.moveDependedOnResizeRight)||void 0===o||o,this.moveDependedOnResizeLeft=null!==(i=e.moveDependedOnResizeLeft)&&void 0!==i&&i,this.moveDependedOnMove=null===(r=e.moveDependedOnMove)||void 0===r||r,this.showTime=null!==(s=e.showTime)&&void 0!==s&&s,this.startFromToday=null===(n=e.startFromToday)||void 0===n||n,this.renderAllTasksFromStart=null===(a=e.renderAllTasksFromStart)||void 0===a||a,this.showMonthMiddle=null!==(h=e.showMonthMiddle)&&void 0!==h&&h,this.showMonthFromStartOnDayView=null!==(d=e.showMonthFromStartOnDayView)&&void 0!==d&&d,this.viewMode=null!==(l=e.viewMode)&&void 0!==l?l:"day",this.isLoading=null!==(u=e.isLoading)&&void 0!==u&&u,this.monthNames=c(c({},W),null!==(f=e.monthNames)&&void 0!==f?f:{}),this.weekdayNames=c(c({},P),null!==(v=e.weekdayNames)&&void 0!==v?v:{}),this.lang=null!==(p=e.lang)&&void 0!==p?p:"ru",this._background=null!==(y=e.background)&&void 0!==y?y:O,this.scale=null!==(g=e.scale)&&void 0!==g?g:1,this.allowMobileTaskMove=null!==(k=e.allowMobileTaskMove)&&void 0!==k&&k,this.allowMobileTaskResize=null!==(w=e.allowMobileTaskResize)&&void 0!==w&&w,this.monthHeight=null!==(m=e.monthHeight)&&void 0!==m?m:55,this.renderMonthBottomLine=null===(T=e.renderMonthBottomLine)||void 0===T||T,this.renderMonthLeftLine=null===(b=e.renderMonthLeftLine)||void 0===b||b,this._monthLineColor=null!==(M=e.monthLineColor)&&void 0!==M?M:S,this.monthTitleFont=null!==(C=e.monthTitleFont)&&void 0!==C?C:"600 20px Arial",this._monthTitleColor=null!==(D=e.monthTitleColor)&&void 0!==D?D:H,this.monthTitleShowYear=null===(E=e.monthTitleShowYear)||void 0===E||E,this._dayHeight=e.dayHeight?e.dayHeight:e.showDayWeekday?48:28,this.renderDayStartMonthLine=null===(z=e.renderDayStartMonthLine)||void 0===z||z,this._dayStartMonthLine=null!==(A=e.dayStartMonthLine)&&void 0!==A?A:S,this._dayBottomLineColor=null!==(F=e.dayBottomLineColor)&&void 0!==F?F:S,this._dayTodayBackground=null!==(Y=e.dayTodayBackground)&&void 0!==Y?Y:L,this._dayHeaderBackground=e.dayHeaderBackground,this._dayHeaderTodayBackground=e.dayHeaderTodayBackground,this._dayHeaderWeekendBackground=e.dayHeaderWeekendBackground,this._dayWeekendBackground=e.dayWeekendBackground,this._dayWeekendColor=e.dayWeekendColor,this.showDayWeekday=null!==(I=e.showDayWeekday)&&void 0!==I&&I,this.dayFontSize=null!==(j=e.dayFontSize)&&void 0!==j?j:14,this.dayFontLineHeight=null!==(U=e.dayFontLineHeight)&&void 0!==U?U:this.dayFontSize,this.dayFontWeight=null!==(V=e.dayFontWeight)&&void 0!==V?V:500,this.dayFontFamily=null!==(q=e.dayFontFamily)&&void 0!==q?q:"Arial",this._dayColor=null!==(N=e.dayColor)&&void 0!==N?N:H,this.weekdayFontSize=null!==(J=e.weekdayFontSize)&&void 0!==J?J:14,this.weekdayFontLineHeight=null!==(G=e.weekdayFontLineHeight)&&void 0!==G?G:this.weekdayFontSize,this.weekdayFontWeight=null!==(K=e.weekdayFontWeight)&&void 0!==K?K:500,this.weekdayFontFamily=null!==(Q=e.weekdayFontFamily)&&void 0!==Q?Q:"Arial",this._weekdayColor=null!==(Z=e.weekdayColor)&&void 0!==Z?Z:H,this._weekdayWeekendColor=e.weekdayWeekendColor,this._dayColWidth=null!==($=e.dayColWidth)&&void 0!==$?$:40,this._weekViewColWidth=null!==(tt=e.weekViewColWidth)&&void 0!==tt?tt:120,this._monthViewColWidth=null!==(et=e.monthViewColWidth)&&void 0!==et?et:180,this._rowHeight=null!==(ot=e.rowHeight)&&void 0!==ot?ot:40,this._colLineColor=null!==(it=e.colLineColor)&&void 0!==it?it:S,this._colStartMonthLineColor=e.colStartMonthLineColor,this._rowLineColor=null!==(rt=e.rowLineColor)&&void 0!==rt?rt:S,this._rowEvenBackground=null!==(st=e.rowEvenBackground)&&void 0!==st?st:O,this._rowOddBackground=null!==(nt=e.rowOddBackground)&&void 0!==nt?nt:O,this._taskDefaultBackground=null!==(at=e.taskDefaultBackground)&&void 0!==at?at:x,this._taskDefaultHoverBackground=null!==(ht=e.taskDefaultHoverBackground)&&void 0!==ht?ht:B,this._taskDefaultStrokeColor=e.taskDefaultStrokeColor,this._taskDefaultHoverStrokeColor=e.taskDefaultHoverStrokeColor,this._taskDefaultColor=null!==(dt=e.taskDefaultColor)&&void 0!==dt?dt:O,this._taskDefaultHoverColor=null!==(lt=e.taskDefaultHoverColor)&&void 0!==lt?lt:O,this._taskDefaultOutlineColor=null!==(ut=e.taskDefaultOutlineColor)&&void 0!==ut?ut:H,this._taskDefaultSubtitleColor=null!==(ct=e.taskDefaultSubtitleColor)&&void 0!==ct?ct:O,this._taskDefaultSubtitleOutlineColor=null!==(ft=e.taskDefaultSubtitleOutlineColor)&&void 0!==ft?ft:H,this._taskSubtitleOffset=null!==(vt=e.taskSubtitleOffset)&&void 0!==vt?vt:10,this._taskHeight=null!==(pt=e.taskHeight)&&void 0!==pt?pt:34,this._taskPadding=null!==(yt=e.taskPadding)&&void 0!==yt?yt:5,this._taskRadius=null!==(gt=e.taskRadius)&&void 0!==gt?gt:2,this.taskFontSize=null!==(kt=e.taskFontSize)&&void 0!==kt?kt:16,this.taskFontLineHeight=null!==(wt=e.taskFontLineHeight)&&void 0!==wt?wt:this.taskFontSize,this.taskFontWeight=null!==(mt=e.taskFontWeight)&&void 0!==mt?mt:400,this.taskFontFamily=null!==(Tt=e.taskFontFamily)&&void 0!==Tt?Tt:"serif",this._taskErrorStrokeColor=e.taskErrorStrokeColor,this._minTaskWidth=null!==(bt=e.minTaskWidth)&&void 0!==bt?bt:10,this.taskRenderResizeControls=null===(Mt=e.taskRenderResizeControls)||void 0===Mt||Mt,this._taskRenderResizeControlsWidth=null!==(Ct=e.taskRenderResizeControlsWidth)&&void 0!==Ct?Ct:6,this._taskRenderResizeControlsColor=null!==(Dt=e.taskRenderResizeControlsColor)&&void 0!==Dt?Dt:O,this.taskRenderResizeControlsRadius=null!==(Ot=e.taskRenderResizeControlsRadius)&&void 0!==Ot?Ot:2,this.taskRenderDepControl=null===(Ht=e.taskRenderDepControl)||void 0===Ht||Ht,this._taskRenderDepRadius=null!==(St=e.taskRenderDepRadius)&&void 0!==St?St:7,this._taskRenderDepOffsetX=null!==(Rt=e.taskRenderDepOffsetX)&&void 0!==Rt?Rt:7,this._taskRenderDepLineWidth=null!==(Lt=e.taskRenderDepLineWidth)&&void 0!==Lt?Lt:1,this._taskRenderDepLineColor=null!==(_t=e.taskRenderDepLineColor)&&void 0!==_t?_t:H,this._taskRenderDepBackground=null!==(Xt=e.taskRenderDepBackground)&&void 0!==Xt?Xt:O,this._arrowColor=null!==(xt=e.arrowColor)&&void 0!==xt?xt:_,this._arrowWidth=null!==(Bt=e.arrowWidth)&&void 0!==Bt?Bt:1,this._arrowActiveColor=null!==(Wt=e.arrowActiveColor)&&void 0!==Wt?Wt:X,this._arrowHoverColor=null!==(Pt=e.arrowHoverColor)&&void 0!==Pt?Pt:B,this._arrowHoverWidth=null!==(Et=e.arrowHoverWidth)&&void 0!==Et?Et:2,this._arrowHoverHeadWidth=null!==(zt=e.arrowHoverHeadWidth)&&void 0!==zt?zt:2,this._arrowRadius=null!==(At=e.arrowRadius)&&void 0!==At?At:2,this.scrollbarXHeight=null!==(Ft=e.scrollbarXHeight)&&void 0!==Ft?Ft:12,this._scrollbarXBackground=null!==(Yt=e.scrollbarXBackground)&&void 0!==Yt?Yt:S,this._scrollbarXLineBackground=null!==(It=e.scrollbarXLineBackground)&&void 0!==It?It:R,this.scrollbarXLineRadius=null!==(jt=e.scrollbarXLineRadius)&&void 0!==jt?jt:6,this.scrollbarYWidth=null!==(Ut=e.scrollbarYWidth)&&void 0!==Ut?Ut:12,this._scrollbarYBackground=null!==(Vt=e.scrollbarYBackground)&&void 0!==Vt?Vt:S,this._scrollbarYLineBackground=null!==(qt=e.scrollbarYLineBackground)&&void 0!==qt?qt:R,this.scrollbarYLineRadius=null!==(Nt=e.scrollbarYLineRadius)&&void 0!==Nt?Nt:6,this.handleChange=e.handleChange,this.handleTaskClick=e.handleTaskClick}return Object.defineProperty(t.prototype,"dayHeight",{get:function(){return this._dayHeight*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskSubtitleOffset",{get:function(){return this._taskSubtitleOffset*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskHeight",{get:function(){return this._taskHeight*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskPadding",{get:function(){return this._taskPadding*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskRadius",{get:function(){return this._taskRadius*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minTaskWidth",{get:function(){return this._minTaskWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskRenderResizeControlsWidth",{get:function(){return this._taskRenderResizeControlsWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskRenderDepOffsetX",{get:function(){return this._taskRenderDepOffsetX*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskRenderDepLineWidth",{get:function(){return this._taskRenderDepLineWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arrowWidth",{get:function(){return this._arrowWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arrowHoverWidth",{get:function(){return this._arrowHoverWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arrowHoverHeadWidth",{get:function(){return this._arrowHoverHeadWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arrowRadius",{get:function(){return this._arrowRadius*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayColWidth",{get:function(){return this._dayColWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weekViewColWidth",{get:function(){return this._weekViewColWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"monthViewColWidth",{get:function(){return this._monthViewColWidth*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowHeight",{get:function(){return this._rowHeight*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskRenderDepRadius",{get:function(){return this._taskRenderDepRadius*this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayFont",{get:function(){var t=this.dayFontSize*this.scale,e=this.dayFontLineHeight*this.scale;return this.dayFontWeight+" "+t+"px/"+e+"px "+this.dayFontFamily},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weekdayFont",{get:function(){var t=this.weekdayFontSize*this.scale,e=this.weekdayFontLineHeight*this.scale;return this.weekdayFontWeight+" "+t+"px/"+e+"px "+this.weekdayFontFamily},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskFont",{get:function(){var t=this.taskFontSize*this.scale,e=this.taskFontLineHeight*this.scale;return this.taskFontWeight+" "+t+"px/"+e+"px "+this.taskFontFamily},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this.root.service.convertColor(this._background,O)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"monthLineColor",{get:function(){return this.root.service.convertColor(this._monthLineColor,S)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"monthTitleColor",{get:function(){return this.root.service.convertColor(this._monthTitleColor,H)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayStartMonthLine",{get:function(){return this.root.service.convertColor(this._dayStartMonthLine,S)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayBottomLineColor",{get:function(){return this.root.service.convertColor(this._dayBottomLineColor,S)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayTodayBackground",{get:function(){return this.root.service.convertColor(this._dayTodayBackground,L)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayHeaderBackground",{get:function(){return this.root.service.convertOptionalColor(this._dayHeaderBackground)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayHeaderTodayBackground",{get:function(){return this.root.service.convertOptionalColor(this._dayHeaderTodayBackground)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayHeaderWeekendBackground",{get:function(){return this.root.service.convertOptionalColor(this._dayHeaderWeekendBackground)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayWeekendBackground",{get:function(){return this.root.service.convertOptionalColor(this._dayWeekendBackground)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayWeekendColor",{get:function(){return this.root.service.convertOptionalColor(this._dayWeekendColor)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dayColor",{get:function(){return this.root.service.convertColor(this._dayColor,H)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weekdayColor",{get:function(){return this.root.service.convertColor(this._weekdayColor,H)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"weekdayWeekendColor",{get:function(){return this.root.service.convertOptionalColor(this._weekdayWeekendColor)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colLineColor",{get:function(){return this.root.service.convertColor(this._colLineColor,S)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colStartMonthLineColor",{get:function(){return this.root.service.convertOptionalColor(this._colStartMonthLineColor)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowLineColor",{get:function(){return this.root.service.convertColor(this._rowLineColor,S)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowEvenBackground",{get:function(){return this.root.service.convertColor(this._rowEvenBackground,O)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowOddBackground",{get:function(){return this.root.service.convertColor(this._rowOddBackground,O)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultBackground",{get:function(){return this.root.service.convertColor(this._taskDefaultBackground,x)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultHoverBackground",{get:function(){return this.root.service.convertColor(this._taskDefaultHoverBackground,B)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultStrokeColor",{get:function(){return this.root.service.convertOptionalColor(this._taskDefaultStrokeColor)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultHoverStrokeColor",{get:function(){return this.root.service.convertOptionalColor(this._taskDefaultHoverStrokeColor)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultColor",{get:function(){return this.root.service.convertColor(this._taskDefaultColor,O)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultHoverColor",{get:function(){return this.root.service.convertColor(this._taskDefaultHoverColor,O)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultOutlineColor",{get:function(){return this.root.service.convertColor(this._taskDefaultOutlineColor,H)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultSubtitleColor",{get:function(){return this.root.service.convertColor(this._taskDefaultSubtitleColor,O)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskDefaultSubtitleOutlineColor",{get:function(){return this.root.service.convertColor(this._taskDefaultSubtitleOutlineColor,H)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskErrorStrokeColor",{get:function(){return this.root.service.convertOptionalColor(this._taskErrorStrokeColor)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskRenderResizeControlsColor",{get:function(){return this.root.service.convertColor(this._taskRenderResizeControlsColor,O)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskRenderDepLineColor",{get:function(){return this.root.service.convertColor(this._taskRenderDepLineColor,H)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"taskRenderDepBackground",{get:function(){return this.root.service.convertColor(this._taskRenderDepBackground,O)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arrowColor",{get:function(){return this.root.service.convertColor(this._arrowColor,_)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arrowActiveColor",{get:function(){return this.root.service.convertColor(this._arrowActiveColor,X)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"arrowHoverColor",{get:function(){return this.root.service.convertColor(this._arrowHoverColor,B)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollbarXBackground",{get:function(){return this.root.service.convertColor(this._scrollbarXBackground,S)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollbarXLineBackground",{get:function(){return this.root.service.convertColor(this._scrollbarXLineBackground,R)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollbarYBackground",{get:function(){return this.root.service.convertColor(this._scrollbarYBackground,S)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollbarYLineBackground",{get:function(){return this.root.service.convertColor(this._scrollbarYLineBackground,R)},enumerable:!1,configurable:!0}),t.prototype.updateTasks=function(t){this.tasks=t,this.root.render()},t.prototype.scrollToToday=function(t){this.root.grid.service.showDay(void 0,!0,!0),t&&this.root.view.handleSetOffsetY(0,!0,!0)},t.prototype.scrollToTask=function(t){this.root.tasks.service.scrollToTask(t)},t.prototype.updateViewMode=function(t){var e=this.root.grid.view.firstTsOnScreen;this.viewMode=t,this.root.grid.init(),this.root.grid.service.showDay(e,!0,!1,!1)},t.prototype.updateIsLoading=function(t){this.isLoading=t,t?this.root.view.setCursor("progress"):this.root.tasks.store.hoverResize?this.root.view.setCursor("col-resize"):this.root.tasks.store.hoverId?this.root.view.setCursor("pointer"):this.root.view.setCursor("auto")},t.prototype.updateScale=function(t){var e=this,o=this.scale,i=t-o,r=this.root.grid.view.firstTsOnScreen;E({duration:300,timing:z,draw:function(s){if(e.scale=o+i*s,e.root.grid.init(),e.root.grid.service.showDay(r,!0,!1,!1),t<o){var n=e.root.view.offsetY*t,a=e.root.grid.service.getLeftAvailableHeight();n>a&&(n=a),e.root.view.handleSetOffsetY(n)}}})},t.prototype.updateColors=function(){this.root.service.clearColorsCache(),this.root.render()},t}(),F=function(){function t(t){this.mouseDownOffset=null,this.isHover=!1,this.minLineWidth=20,this.root=t,this.destroyHandleMouseDown=this.root.controller.on("mousedown",this.handleMouseDown.bind(this)),this.destroyHandleTouchEnd=this.root.controller.on("touchend",this.handleTouchEnd.bind(this)),this.destroyMouseMove=this.root.controller.on("mousemove",this.handleMouseMove.bind(this)),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMoveScrollbar=this.handleMoveScrollbar.bind(this)}return Object.defineProperty(t.prototype,"height",{get:function(){return this.root.api.scrollbarXHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.root.view.canvasHeight-this.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundLineWidth",{get:function(){return this.root.view.canvasWidth},enumerable:!1,configurable:!0}),t.prototype.destroyEvents=function(){this.destroyHandleMouseDown(),this.destroyMouseMove(),this.destroyHandleTouchEnd()},t.prototype.isLineClick=function(t){var e=t.offsetX,o=t.offsetY,i=this.getLineXAndWidth(),r=i.x,s=i.width;return!(e<r||e>r+s)&&!(o<this.top)},t.prototype.isBackgroundClick=function(t){var e=t.offsetY,o=t.offsetX;return e>=this.top&&o<this.backgroundLineWidth},t.prototype.handleMouseDown=function(t){var e=this.isLineClick(t),o=this.isBackgroundClick(t);e?this.handleLinkMouseDown(t):o&&this.handleBackgroundMouseDown(t),(e||o)&&this.root.controller.stopPropagation(t)},t.prototype.handleTouchEnd=function(t){var e=p(t,this.root.canvas,this.root.ctx);this.isBackgroundClick(e)&&(this.handleBackgroundMouseDown(e),this.root.controller.stopPropagation(t))},t.prototype.handleLinkMouseDown=function(t){this.mouseDownOffset=t.screenX,document.addEventListener("mousemove",this.handleMoveScrollbar),document.addEventListener("mouseup",this.handleMouseUp)},t.prototype.handleBackgroundMouseDown=function(t){var e=this.getScaledOffset(t.offsetX);this.root.view.handleSetOffsetX(e,!0,!0)},t.prototype.getScaledOffset=function(t){return this.root.grid.service.getFullAvailableWidth()/this.backgroundLineWidth*t},t.prototype.handleMouseUp=function(){this.mouseDownOffset=null,document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("mousemove",this.handleMoveScrollbar)},t.prototype.handleMouseMove=function(t){var e=this.isLineClick(t),o=this.isBackgroundClick(t);e?this.root.view.setCursor("grab"):o&&this.root.view.setCursor("pointer"),e||o?(this.root.controller.stopPropagation(t),this.isHover=!0):this.isHover&&(this.isHover=!1,this.root.view.setCursor("auto"))},t.prototype.handleMoveScrollbar=function(t){if(null!==this.mouseDownOffset){var e=t.screenX-this.mouseDownOffset,o=this.root.view.offsetX+this.getScaledOffset(e);this.root.view.handleSetOffsetX(o),this.mouseDownOffset=t.screenX}},t.prototype.renderBackground=function(){var t=this.root.ctx;t.fillStyle=this.root.api.scrollbarXBackground,t.fillRect(0,this.top,this.backgroundLineWidth,this.height)},t.prototype.renderLine=function(){var t=this.root.ctx,e=this.getLineXAndWidth(),o=e.x,i=e.width;t.fillStyle=this.root.api.scrollbarXLineBackground,v(t,o,this.top,i,this.height,this.root.api.scrollbarXLineRadius,this.root.api.scrollbarXLineBackground)},t.prototype.getLineXAndWidth=function(){var t=this.root.grid.service.getFullAvailableWidth(),e=this.root.view.offsetX/t*this.backgroundLineWidth,o=this.backgroundLineWidth/t*this.backgroundLineWidth;return o<this.minLineWidth&&e+(o=this.minLineWidth)>this.root.view.canvasWidth-this.minLineWidth&&(e=this.root.view.canvasWidth-o-this.minLineWidth),{x:e,width:o}},t.prototype.render=function(){this.renderBackground(),this.renderLine()},t}(),Y=function(){function t(t){this.mouseDownOffset=null,this.bottomOffset=12,this.minLineHeight=20,this.isHover=!1,this.root=t,this.destroyHandleMouseDown=this.root.controller.on("mousedown",this.handleMouseDown.bind(this)),this.destroyHandleTouchEnd=this.root.controller.on("touchend",this.handleTouchEnd.bind(this)),this.destroyMouseMove=this.root.controller.on("mousemove",this.handleMouseMove.bind(this)),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleMoveScrollbar=this.handleMoveScrollbar.bind(this)}return Object.defineProperty(t.prototype,"left",{get:function(){return this.root.view.canvasWidth-this.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.root.grid.view.headerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundLineHeight",{get:function(){return this.root.view.canvasHeight-this.bottomOffset-this.top},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.root.api.scrollbarYWidth},enumerable:!1,configurable:!0}),t.prototype.destroyEvents=function(){this.destroyHandleMouseDown(),this.destroyMouseMove(),this.destroyHandleTouchEnd()},t.prototype.isLineClick=function(t){if(!this.needRender())return!1;var e=t.offsetX,o=t.offsetY,i=this.getLineYAndHeight(),r=i.y,s=i.height;return!(e<this.left)&&!(o<r+this.top||o>r+this.top+s)},t.prototype.isBackgroundClick=function(t){if(!this.needRender())return!1;var e=t.offsetX,o=t.offsetY;return e>=this.left&&o>this.top&&o<this.root.view.canvasHeight-this.bottomOffset},t.prototype.handleMouseDown=function(t){var e=this.isLineClick(t),o=this.isBackgroundClick(t);e?this.handleLinkMouseDown(t):o&&this.handleBackgroundMouseDown(t),(e||o)&&this.root.controller.stopPropagation(t)},t.prototype.handleTouchEnd=function(t){var e=p(t,this.root.canvas,this.root.ctx);this.isBackgroundClick(e)&&(this.handleBackgroundMouseDown(e),this.root.controller.stopPropagation(t))},t.prototype.handleLinkMouseDown=function(t){this.mouseDownOffset=t.screenY,document.addEventListener("mousemove",this.handleMoveScrollbar),document.addEventListener("mouseup",this.handleMouseUp)},t.prototype.handleMouseUp=function(){this.mouseDownOffset=null,document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("mousemove",this.handleMoveScrollbar)},t.prototype.handleBackgroundMouseDown=function(t){var e=this.getScaledOffset(t.offsetY);this.root.view.handleSetOffsetY(e,!0,!0)},t.prototype.getScaledOffset=function(t){var e=this.root.grid.service.getLeftAvailableHeight();return t-=this.top,e/this.backgroundLineHeight*t},t.prototype.handleMouseMove=function(t){var e=this.isLineClick(t),o=this.isBackgroundClick(t);e?this.root.view.setCursor("grab"):o&&this.root.view.setCursor("pointer"),e||o?(this.root.controller.stopPropagation(t),this.isHover=!0):this.isHover&&(this.isHover=!1,this.root.view.setCursor("auto"))},t.prototype.handleMoveScrollbar=function(t){if(null!==this.mouseDownOffset){var e=t.screenY-this.mouseDownOffset,o=this.root.view.offsetY+this.getScaledOffset(this.top+e),i=this.root.grid.service.getLeftAvailableHeight();o>i&&(o=i),this.root.view.handleSetOffsetY(o),this.mouseDownOffset=t.screenY}},t.prototype.needRender=function(){return this.root.grid.service.getLeftAvailableHeight()>0},t.prototype.renderBackground=function(){if(this.needRender()){var t=this.root.ctx;t.fillStyle=this.root.api.scrollbarYBackground,t.fillRect(this.left,this.top,this.width,this.backgroundLineHeight)}},t.prototype.renderLine=function(){if(this.needRender()){var t=this.root.ctx,e=this.getLineYAndHeight(),o=e.y,i=e.height;v(t,this.left,o+this.top,this.width,i,this.root.api.scrollbarYLineRadius,this.root.api.scrollbarYLineBackground),this.root.ctx.fillStyle=this.root.api.scrollbarYLineBackground}},t.prototype.getLineYAndHeight=function(){var t=this.root.grid.service.getFullAvailableHeight(),e=this.root.view.offsetY/t*this.backgroundLineHeight,o=this.backgroundLineHeight/t*this.backgroundLineHeight;return o<this.minLineHeight&&(o=this.minLineHeight),{y:e,height:o}},t.prototype.render=function(){this.renderBackground(),this.renderLine()},t}(),I=function(){function t(t){this.offsetX=0,this.offsetY=0,this.pixelRatio=1,this.canvasWidth=1,this.canvasHeight=1,this.root=t,this.updateCanvasSizeAndRender=this.updateCanvasSizeAndRender.bind(this),this.updateCanvasSize(),this.attachEvents(),this.scrollbarX=new F(t),this.scrollbarY=new Y(t),this.pixelRatio=k(t.ctx),this.canvasWidth=this.root.canvas.width/this.pixelRatio,this.canvasHeight=this.root.canvas.height/this.pixelRatio}return t.prototype.render=function(){this.pixelRatio=k(this.root.ctx),this.canvasWidth=this.root.canvas.width/this.pixelRatio,this.canvasHeight=this.root.canvas.height/this.pixelRatio,this.root.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.root.ctx.fillStyle=this.root.api.background,this.root.ctx.rect(0,0,this.root.view.canvasWidth,this.root.view.canvasHeight),this.root.ctx.fill(),this.root.grid.view.renderGrid(),this.root.tasks.view.render(),this.scrollbarX.render(),this.scrollbarY.render(),this.root.grid.view.renderHeader()},t.prototype.attachEvents=function(){window.addEventListener("resize",this.updateCanvasSizeAndRender)},t.prototype.destroyEvents=function(){window.removeEventListener("resize",this.updateCanvasSizeAndRender)},t.prototype.updateCanvasSizeAndRender=function(){this.updateCanvasSize(),this.root.render()},t.prototype.updateCanvasSize=function(){w(this.root.canvas,this.root.ctx,this.root.root.offsetWidth,this.root.root.offsetHeight)},t.prototype.handleChangeOffsetX=function(t,e){void 0===t&&(t=10),void 0===e&&(e=!0),this.offsetX+=t,this.offsetX<0&&(this.offsetX=0),this.root.grid.service.validateOffsetX(),e&&this.render()},t.prototype.handleSetOffsetX=function(t,e,o,i){var r=this;if(void 0===t&&(t=0),void 0===e&&(e=!0),void 0===o&&(o=!1),o){var s=this.offsetX,n=t-s;if(i||(i=(n>0?n:-1*n)/this.root.grid.service.getFullAvailableWidth()*1500),0===n)return;E({duration:i,timing:z,draw:function(t){r.offsetX=s+n*t,r.offsetX<0&&(r.offsetX=0),(1===t||n>0)&&r.root.grid.service.validateOffsetX(),r.render()}})}else this.offsetX=t,this.offsetX<0&&(this.offsetX=0),this.root.grid.service.validateOffsetX(),e&&this.render()},t.prototype.handleSetOffsetY=function(t,e,o,i){var r=this;if(void 0===t&&(t=0),void 0===e&&(e=!0),void 0===o&&(o=!1),o){var s=this.offsetY,n=t-s;if(i||(i=(n>0?n:-1*n)/this.root.grid.service.getFullAvailableHeight()*1500),0===n)return;E({duration:i,timing:z,draw:function(t){r.offsetY=s+n*t,r.offsetY<0&&(r.offsetY=0),r.render()}})}else this.offsetY=t,this.offsetY<0&&(this.offsetY=0),e&&this.render()},t.prototype.setCursor=function(t){"auto"===t&&this.root.api.isLoading&&(t="progress"),this.root.root.style.cursor=t},t}();function j(t,e){var o=!1;return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];o||(t.apply(this,i),o=!0,setTimeout((function(){return o=!1}),e))}}var U=function(){function t(t){this.events={},this.touchOffsetX=null,this.touchOffsetY=null,this.previousTouchOffsetX=null,this.previousTouchOffsetY=null,this.root=t,this.handleMouseMove=j(this.handleMouseMove.bind(this),32),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.handleClick=this.handleClick.bind(this),this.handleScroll=this.handleScroll.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=j(this.handleTouchMove.bind(this),32),this.handleTouchEnd=this.handleTouchEnd.bind(this),this.attachEvents()}return t.prototype.attachEvents=function(){var t,e=this;this.root.canvas.addEventListener("mousemove",this.handleMouseMove),this.root.canvas.addEventListener("mousedown",this.handleMouseDown),this.root.canvas.addEventListener("mouseup",this.handleMouseUp),this.root.canvas.addEventListener("click",this.handleClick),this.root.canvas.addEventListener("wheel",this.handleScroll),this.root.canvas.addEventListener("touchstart",this.handleTouchStart),this.root.canvas.addEventListener("touchmove",this.handleTouchMove),this.root.canvas.addEventListener("touchend",this.handleTouchEnd),(null===(t=null===document||void 0===document?void 0:document.fonts)||void 0===t?void 0:t.ready)&&document.fonts.ready.then((function(){return e.root.render()}))},t.prototype.destroyEvents=function(){this.root.canvas.removeEventListener("mousemove",this.handleMouseMove),this.root.canvas.removeEventListener("mousedown",this.handleMouseDown),this.root.canvas.removeEventListener("mouseup",this.handleMouseUp),this.root.canvas.removeEventListener("click",this.handleClick),this.root.canvas.removeEventListener("wheel",this.handleScroll),this.root.canvas.removeEventListener("touchstart",this.handleTouchStart),this.root.canvas.removeEventListener("touchmove",this.handleTouchMove),this.root.canvas.removeEventListener("touchend",this.handleTouchEnd)},t.prototype.on=function(t,e){var o=this;return this.events[t]||(this.events[t]=[]),this.events[t].push(e),function(){o.events[t]=o.events[t].filter((function(t){return t!==e}))}},t.prototype.handleMouseMove=function(t){this.events.mousemove&&this.events.mousemove.every((function(e){return!t._stopPropagation&&(e(t),!0)}))},t.prototype.handleMouseDown=function(t){this.events.mousedown&&this.events.mousedown.every((function(e){return!t._stopPropagation&&(e(t),!0)}))},t.prototype.handleMouseUp=function(t){this.events.mouseup&&this.events.mouseup.every((function(e){return!t._stopPropagation&&(e(t),!0)}))},t.prototype.handleClick=function(t){this.events.click&&this.events.click.forEach((function(e){return e(t)}))},t.prototype.handleScroll=function(t){if(t.preventDefault(),t.shiftKey||0!==t.deltaX){var e=this.root.view.offsetX;t.shiftKey?e+=t.deltaY:e+=t.deltaX,e<0&&(e=0),this.root.view.handleSetOffsetX(e)}else{var o=this.root.view.offsetY+t.deltaY,i=this.root.grid.service.getLeftAvailableHeight();o<0?o=0:o>i&&(o=i),this.root.view.handleSetOffsetY(o)}},t.prototype.handleTouchStart=function(t){var e,o,i;t.preventDefault(),null===(e=this.events.touchstart)||void 0===e||e.every((function(e){return!t._stopPropagation&&(e(t),!0)}));var r=null===(o=t.touches[0])||void 0===o?void 0:o.screenX,s=null===(i=t.touches[0])||void 0===i?void 0:i.screenY;r&&(this.touchOffsetX=r),s&&(this.touchOffsetY=s)},t.prototype.handleTouchMove=function(t){var e,o,i;if(t.preventDefault(),null===(e=this.events.touchmove)||void 0===e||e.every((function(e){return!t._stopPropagation&&(e(t),!0)})),!this.root.tasks.controller.mouseDownOffsetX){var r=null===(o=t.changedTouches[0])||void 0===o?void 0:o.screenX,s=null===(i=t.changedTouches[0])||void 0===i?void 0:i.screenY;if(r&&null!==this.touchOffsetX&&r!==this.touchOffsetX){var n=this.touchOffsetX-r,a=this.root.view.offsetX+n;this.root.view.handleSetOffsetX(a),this.previousTouchOffsetX=this.touchOffsetX,this.touchOffsetX=r}if(s&&null!==this.touchOffsetY&&s!==this.touchOffsetY){n=this.touchOffsetY-s,a=this.root.view.offsetY+n;var h=this.root.grid.service.getLeftAvailableHeight();a>h&&(a=h),this.root.view.handleSetOffsetY(a),this.previousTouchOffsetY=this.touchOffsetY,this.touchOffsetY=s}}},t.prototype.handleTouchEnd=function(t){var e;(!this.events.touchend||this.previousTouchOffsetX||this.previousTouchOffsetY||this.events.touchend.every((function(e){return!t._stopPropagation&&(e(t),!0)})),this.previousTouchOffsetX&&this.touchOffsetX)&&(((e=this.previousTouchOffsetX-this.touchOffsetX)>30||e<-30)&&(e*=7,this.root.view.handleSetOffsetX(this.root.view.offsetX+e,!0,!0,500)));if(this.previousTouchOffsetY&&this.touchOffsetY&&((e=this.previousTouchOffsetY-this.touchOffsetY)>30||e<-30)){e*=7;var o=this.root.view.offsetY+e,i=this.root.grid.service.getLeftAvailableHeight();o>i&&(o=i),this.root.view.handleSetOffsetY(o,!0,!0,500)}t.preventDefault(),this.touchOffsetX=null,this.touchOffsetY=null,this.previousTouchOffsetX=null,this.previousTouchOffsetY=null},t.prototype.stopPropagation=function(t){t._stopPropagation=!0},t}(),V=function(){function t(t,e){var o=document.querySelector(t);if(!o)throw new Error("Root element doesn't found");this.root=o,this.canvas=document.createElement("canvas"),this.root.append(this.canvas);var i=this.canvas.getContext("2d");if(!i)throw new Error("Canvas context doesn't gotten");w(this.canvas,i,this.root.offsetWidth,this.root.offsetHeight),this.ctx=i,this.service=new D(this),this.api=new A(this,e),this.controller=new U(this),this.view=new I(this),this.grid=new l(this),this.tasks=new C(this),this.init()}return t.prototype.init=function(){this.grid.init(),this.tasks.init(),this.render(),this.api.isLoading&&this.view.setCursor("progress")},t.prototype.destroy=function(){this.controller.destroyEvents(),this.view.destroyEvents(),this.tasks.destroy(),this.service.unmountConvertColorDiv()},t.prototype.render=function(){this.view.render()},t}();return function(){function t(t,e){this.root=new V(t,e)}return t.prototype.updateTasks=function(t){this.root.api.updateTasks(t)},t.prototype.scrollToToday=function(t){this.root.api.scrollToToday(t)},t.prototype.scrollToTask=function(t){this.root.api.scrollToTask(t)},t.prototype.updateViewMode=function(t){this.root.api.updateViewMode(t)},t.prototype.updateIsLoading=function(t){this.root.api.updateIsLoading(t)},t.prototype.updateScale=function(t){this.root.api.updateScale(t)},t.prototype.updateColors=function(){this.root.api.updateColors()},t.prototype.destroy=function(){this.root.destroy()},t}()}();
